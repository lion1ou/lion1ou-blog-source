---
title: MongoDB数据迁移
toc: true
comments: true
categories: NodeJs
tags: NodeJs
date: 2016-11-20 11:18:31
photos:
description:
---

MongoDB数据迁移主要用到两个命令，一个是备份命令`mongodump`，一个是恢复命令`mongorestore`。

<!--more-->
### mongodump：

在Mongodb中我们使用mongodump命令来备份MongoDB数据。该命令可以导出所有数据到指定目录中。mongodump命令可以通过参数指定导出的数据量级转存的服务器。

在MongoDB处于连接状态下，执行下列命令，命令格式：
```shell
mongodump -h 'dbhost'  -d 'dbname' -o 'dbdirectory'
```

-h:  mongodb所在服务器地址，例如127.0.0.1，也可以指定端口:127.0.0.1:27017 

-d:  需要备份的数据库名称，例如：test_data

-o:  备份的数据存放的位置，例如：/home/bak(需要提前新建)

-u:  用户名称，使用权限验证的mongodb服务，需要指明导出账号

-p:  用户密码，使用权限验证的mongodb服务，需要指明导出账号密码

如下：

![](http://ww1.sinaimg.cn/large/006y8lVagw1fa9z7g43u7j30eo03dt9y.jpg)

本人没有指定文件夹，则在根文件夹内会自动创建一个dump文件夹，用于存储数据

![](http://ww1.sinaimg.cn/large/006y8lVagw1fa9z8on9w2j30k1096abe.jpg)


### mongorestore：
mongodb使用 mongorestore 命令来恢复备份的数据。

在MongoDB处于连接状态下，执行下列命令，命令格式：

```shell
mongorestore -h 'dbhost' -d 'dbname' --dir 'dbdireactory'
```
-h:  mongodb所在服务器地址

-d:  需要恢复备份的数据库名称，例如：test_data，可以跟原来备份的数据库名称不一样

--dir: 备份数据所在位置，例如：/home/bak/test，mongoDB-3.0之前版本是用`-directoryperdb`

-drop: 加上这个参数的时候，会在恢复数据之前删除当前数据；

如下图：

![](http://ww2.sinaimg.cn/large/006y8lVagw1fa9zc2fkqxj30hz0b1wl6.jpg)

这样数据就恢复到新的MongoDB内了。





