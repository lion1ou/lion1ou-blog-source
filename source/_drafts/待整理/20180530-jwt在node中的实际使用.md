---
title: jwt在node中的实际使用
toc: true
comments: true
date: 2018-05-30 23:13:54
categories:
tags:
photos:
---

jwt在之前的文章中已经有所介绍，这里分享一下，有关jwt在node中的实际使用。

<!--more-->

在node中需要需要引入两个库

* jsonwebtoken
* koa-jwt

使用`jsonwebtoken`来加密生成返回给客户端的token

```js
const jwt = require('jsonwebtoken');
const secret = 'aaa'; // 私钥，用于加密时混淆

//jwt生成token
const token = jwt.sign({
    name: 123
}, secret, {
    expiresIn:  60 //秒到期时间
});
console.log(token);
//解密token
jwt.verify(token, secret, function (err, decoded) {
    if (!err){
        console.log(decoded.name);  //会输出123，如果过了60秒，则有错误。
    }
});
```

我们看看jwt.sign 生成的token:
【eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoxMjMsImlhdCI6MTQ5MTQ3NTQyNCwiZXhwIjoxNDkxNDc1NDg0fQ.hYNC4qFAyhZClmPaLixfN137d41R2CFk1xPlfLK10JU】

我们仔细看这字符串，分为三段。分别被 "." 隔开。
我们对：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 由 base64 解密得到
{"alg":"HS256","typ":"JWT"} alg 是加密算法名字，typ 是类型

这段: eyJuYW1lIjoxMjMsImlhdCI6MTQ5MTQ3NTQyNCwiZXhwIjoxNDkxNDc1NDg0fQ 由base64解密得到： {"name":123,"iat":1491475424,"exp":1491475484} name 是我们储存的内容，但是多了 iat（创建的时间戳），exp（到期时间戳）。

最后一段是hYNC4qFAyhZClmPaLixfN137d41R2CFk1xPlfLK10JU，是由前面俩段字符串
HS256 加密后得到。 所以前面的任何一个字段修改，都会导致加密后的字符串不匹配。

https://www.jianshu.com/p/176198fbdb35
https://segmentfault.com/a/1190000009494020
https://github.com/koajs/jwt






**转载请标注原文地址**

