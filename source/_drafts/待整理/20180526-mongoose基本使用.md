---
title: mongoose基本使用
toc: true
comments: true
date: 2018-05-26 23:12:55
categories:
tags:
photos:
---
## MongoDB

MongoDB是一个开源的NoSQL数据库，相比MySQL那样的关系型数据库，它更显得轻巧、灵活，非常适合在数据规模很大、事务性不强的场合下使用。同时它也是一个对象数据库，没有表、行等概念，也没有固定的模式和结构，所有的数据以文档的形式存储(文档，就是一个关联数组式的对象，它的内部由属性组成，一个属性对应的值可能是一个数、字符串、日期、数组，甚至是一个嵌套的文档。)，数据格式就是JSON。

## Mongoose

Mongoose是MongoDB的一个对象模型工具，是基于node-mongodb-native开发的MongoDB nodejs驱动，可以在异步的环境下执行。同时它也是针对MongoDB操作的一个对象模型库，封装了MongoDB对文档的的一些增删改查等常用方法，让NodeJS操作Mongodb数据库变得更加灵活简单。

Mongoose，因为封装了对MongoDB对文档操作的常用处理方法，可以高效的操作mongodb,同时可以理解mongoose是一个简易版的orm ，提供了类似schema定义，hook、plugin、virtual、populate等机制，让NodeJS操作Mongodb数据库变得特别简单!

<!--more-->

### Mongoose 基本使用

* 准备

        1、 安装mongoose

        $ npm install --save mongoose

        2、 引用mongoose

        var mongoose = require("mongoose");

        3、 使用"mongoose"连接数据库

        var db = mongoose.connect("mongodb://user:pass@ip:port/database");

* 测试

```js

const mongoose = require('mongoose')

var db = mongoose.connect(`mongodb://127.0.0.1:27017/test`)

mongoose.connection.on("open", () => {
  console.log('连接成功')
})

mongoose.connection.on("error", (err) => {
  console.log('连接错误', err)
});

```

* 最小DEMO

这里给出极简demo，用于讲解mongoose从连接数据库到对数据库进行操作完整过程，这样更容易让读者了解核心原理，代码如下：

```js
// 1、引入`mongoose`模块
var mongoose = require('mongoose');

// 2、通过`mongoose.connect`连接mongodb数据库
mongoose.connect('mongodb://127.0.0.1/db_helloworld');

// 3、通过`mongoose.model`定义模型(model)
var Cat = mongoose.model('Cat', { name: String });

// 4、通过`new`关键字实例化Cat模型，参数是`{ name: 'Zildjian' }`，创建kitty对象
var kitty = new Cat({ name: 'Zildjian' });

// 5、执行`kitty.save`来保存到数据库
kitty.save(function (err) {
  if (err) {
    console.log('save error:' + err);
  }
  console.log('save sucess');
});
```

* 核心步骤说明

        * 定义模型(model)
        * 通过new关键字实例化Cat模型，创建kitty对象
        * 执行kitty.save来保存到数据库
        * 这个其实就是mongoose最常见的用法，首先约定schema，即在模型model定义的时候指定字段和字段类型，避免乱用schema-free问题。之后对实例化模型创建的对象进行操作，完成我们常见的增删改查功能。

### 代码实现



**转载请标注原文地址**

